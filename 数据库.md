# 1、索引

> [CodingLabs - MySQL索引背后的数据结构及算法原理](http://blog.codinglabs.org/articles/theory-of-mysql-index.html)

## 1.1、概念

索引（Index）是帮助MySQL高效获取数据的数据结构。索引的本质：索引是数据结构。

**创建主键的时候自动给主键添加了索引，且该索引为唯一性索引。**

即主键一定是唯一性索引。

但是一张表中可以有多个唯一性索引，所以唯一性索引不一定是主键。

**在许多场合，人们创建唯一索引的目的往往不是为了提高访问速度，而只是为了避免数据出现重复。**

![微信截图_20210512142452](C:\Users\Administrator\Desktop\微信截图_20210512142452.png)

![image-20210512144839786](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512144839786.png)

## 1.2、B树

[漫画：什么是B-树？ (qq.com)](https://mp.weixin.qq.com/s?__biz=MzIxMjE5MTE1Nw==&mid=2653190965&idx=1&sn=53f78fa037386f85531832cd5322d2a0&chksm=8c9909efbbee80f90512f0c36356c31cc74c388c46388dc2317d43c8f8597298f233ca9c29e9&scene=21#wechat_redirect)

B-树就是B树（Balance Tree），中间的横线不是减号。数据库的索引是在磁盘上的。

每比较一个节点都io一次，最坏情况下，磁盘io次数等于索引树的高度

把原本瘦高的二叉查找树变成矮胖的B树。

![image-20210512160844465](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512160844465.png)

m阶的B树具有如下几个特征：

1.根结点至少有两个子女。

2.每个中间节点都包含k-1个元素和k个孩子，其中 m/2 <= k <= m

3.每一个叶子节点都包含k-1个元素，其中 m/2 <= k <= m

4.所有的叶子结点都位于同一层。

5.每个节点中的元素从小到大排列，节点当中k-1个元素正好是k个孩子包含的元素的值域分划。

![image-20210512162430473](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512162430473.png)

![image-20210512162500358](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512162500358.png)

单节点包含的元素不能超过阶数减一（m-1）个。

**插入：**

![image-20210512163005751](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512163005751.png)

![image-20210512163055145](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512163055145.png)

![image-20210512163454414](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512163454414.png)

**删除：**

![image-20210512163717676](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512163717676.png)

**应用：**

![image-20210512163548470](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512163548470.png)

**卫星数据**

![image-20210512165226158](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512165226158.png)

![image-20210512165258176](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512165258176.png)

## 1.3、B+树

[漫画：什么是B+树？ (qq.com)](https://mp.weixin.qq.com/s?__biz=MzIxMjE5MTE1Nw==&mid=2653191027&idx=1&sn=4ba22e3ec8bd149f69fc0aba72e4347e&chksm=8c9909a9bbee80bfa1d8497ff0525df130414c1731b5aa5287bf16ea1cf86c8d8e6f20782184&scene=21#wechat_redirect)

![image-20210512164139666](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512164139666.png)

![image-20210512164449896](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512164449896.png)

添加元素的时候：

![image-20210512164656494](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512164656494.png)

叶子节点包含全部元素信息，每一个叶子节点都带有指向下一个叶子节点的指针，形成了一个有序链表。

**B+树中，只有叶子节点带有卫星数据，其余中间节点仅仅是索引，没有任何数据关联。**

![image-20210512165448933](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512165448933.png)

![image-20210512165611124](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210512165611124.png)

**查询对比：**

- 单元素查询：B+树查询流程看起来和B树差不多，但是首先，B+树的中间节点没有卫星数据，因此同样大小的磁盘页可以容纳更多的节点元素，在数据量相同的情况下，B+树的深度会比B树更浅，查询的IO次数就更少；其次，B+树必须查询到叶子节点，查询性能稳定，而B树有可能会查询到叶子节点，也有可能是查询到中间节点，性能是不稳定的。















